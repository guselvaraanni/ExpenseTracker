<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Expense Tracker - Add Expense</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#2563EB",
            background: "#101922",
            card: "#1F2937",
            sidebar: "#111827",
            text: "#FFFFFF",
            muted: "#9CA3AF",
            border: "#374151"
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
          },
          boxShadow: {
            soft: "0 2px 4px rgba(0,0,0,0.2)",
          }
        },
      },
    };
</script>
<style>
.material-symbols-outlined {
  font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
}
body {
  font-size: 0.9rem; /* same as settings page */
  background-color: #101922;
  color: #E5E7EB;
}
</style>
</head>
<body class="bg-background font-sans text-text">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-60 bg-card border-r border-border hidden lg:flex flex-col fixed h-full">
      <div class="flex items-center gap-2 px-5 h-16 border-b border-border">
        <span class="material-symbols-outlined text-primary">account_balance</span>
        <h1 class="text-base font-semibold">ExpenseApp</h1>
      </div>
      <nav class="flex-1 p-3 space-y-1 text-sm">
        <a class="flex items-center gap-2 rounded-md bg-primary/20 text-primary px-3 py-2" href="{{ url_for('dashboard') }}">
          <span class="material-symbols-outlined">dashboard</span> Dashboard
        </a>
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="{{ url_for('expense') }}">
          <span class="material-symbols-outlined">add_box</span> Add Expense
        </a>
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="{{ url_for('report') }}">
          <span class="material-symbols-outlined">analytics</span> Reports
        </a>
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="{{ url_for('settings') }}">
          <span class="material-symbols-outlined">settings</span> Settings
        </a>
      </nav>
      <div class="p-3">
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="#">
          <span class="material-symbols-outlined">logout</span> Logout
        </a>
      </div>
    </aside>

    <div class="flex-1 flex flex-col overflow-y-auto lg:ml-60">
    <!-- Header -->
    <header class="sticky top-0 z-10 flex h-16 items-center justify-between border-b border-border bg-background/80 px-4 sm:px-6">
      <h2 class="text-lg font-semibold">Add Expense</h2>
      <div class="flex items-center gap-3">
        <button class="p-2 rounded-full hover:bg-gray-800 text-muted">
          <span class="material-symbols-outlined">notifications</span>
        </button>
        <button class="flex items-center gap-1 bg-card text-sm px-3 py-1.5 rounded-md hover:bg-gray-700">
          <span class="material-symbols-outlined text-sm">download</span> CSV
        </button>
        <button class="flex items-center gap-1 bg-primary text-white text-sm px-3 py-1.5 rounded-md hover:bg-primary/90">
          <span class="material-symbols-outlined text-sm">picture_as_pdf</span> PDF
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8">
      <div class="max-w-3xl mx-auto">
        <!-- <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Add Expense</h1> -->
        <form id="expenseForm" class="space-y-6">

          <!-- Amount -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="amount">Amount</label>
            <div class="relative">
              <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2 text-gray-500 dark:text-gray-400"></div>
              <input class="form-input w-80 rounded-lg bg-white/5 dark:bg-black/10 border border-gray-300 dark:border-gray-700 focus:ring-primary focus:border-primary text-gray-900 dark:text-white text-sm h-9" id="amount" name="amount" placeholder="0.00" type="number"/>
            </div>
          </div>

          <!-- Category -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="category">Category</label>
            <select class="form-input w-80 rounded-lg bg-white/5 dark:bg-black/10 border border-gray-300 dark:border-gray-700 focus:ring-primary focus:border-primary text-gray-900 dark:text-white text-sm h-9" id="category" name="category">
              <option>Select a category</option>
              <option>Food</option>
              <option>Travel</option>
              <option>Bills</option>
              <option>Entertainment</option>
            </select>
          </div>

          <!-- Date -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="date">Date</label>
            <input class="form-input w-80 rounded-lg bg-white/5 dark:bg-black/10 border border-gray-300 dark:border-gray-700 focus:ring-primary focus:border-primary text-gray-900 dark:text-white text-sm h-9" id="date" name="date" type="date" value="2024-07-29"/>
          </div>

          <!-- Description -->
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" for="description">Description</label>
            <textarea class="form-input w-full rounded-lg bg-white/5 dark:bg-black/10 border border-gray-300 dark:border-gray-700 focus:ring-primary focus:border-primary text-gray-900 dark:text-white text-sm h-24" id="description" name="description" placeholder="e.g., Coffee with colleagues"></textarea>
          </div>

          <!-- Buttons -->
          <div class="flex justify-end gap-3 pt-3">
            <button class="px-3 py-1.5 bg-card text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-700" type="button">
              Cancel
            </button>
            <!-- <button id="save-btn" onclick="window.location.href='{{ url_for('save_expense') }}'" class="px-3 py-1.5 bg-primary text-white text-sm font-medium rounded-lg hover:bg-opacity-90" type="submit"> 
              Save Expense
            </button> -->
            <button id="save-btn" class="px-3 py-1.5 bg-primary text-white text-sm font-medium rounded-lg hover:bg-opacity-90" type="submit"> 
              Save Expense
            </button>
          </div>

          <!-- <div class="mt-4">
                        <button id="update-btn"
                           class="px-3 py-1.5 bg-primary text-white text-sm font-medium rounded-lg hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary dark:focus:ring-offset-background-dark">
                        Update Information
                        </button>
                     </div> -->
                     <!-- Toast (hidden by default) -->
                     <div id="toast"
                        class="hidden fixed bottom-5 right-5 bg-blue-100 text-blue-800 px-4 py-2 shadow-lg border border-blue-300">
                        Info updated successfully
                     </div>
                     
  <script>
    const expenseForm = document.getElementById("expenseForm");

    expenseForm.addEventListener("submit", function (e) {
      e.preventDefault();

      const amount = parseFloat(document.getElementById("amount").value);

      const payload = {
        amount: Math.abs(amount),
        category: document.getElementById("category").value,
        date: document.getElementById("date").value,
        desc: document.getElementById("description").value.trim(),
        type: "Expense"   // ðŸ‘ˆ FORCE expense
      };

      fetch("/save_expense", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(res => res.json())
      
      .then(data => {
        if (data.success) {
          alert("Expense added successfully!");
          window.location.href = "/dashboard"; // ðŸ‘ˆ IMPORTANT
        }
      });
    });

//   function saveExpense(formData) {
//   return fetch("/save_expense", {
//     method: "POST",
//     headers: { "Content-Type": "application/json" },
//     body: JSON.stringify(formData)
//   }).then(res => res.json());
// }

  </script>

        </form>
      </div>
    </main>
  </div>
</body>
</html>