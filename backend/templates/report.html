<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Reports</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#2563EB",
            background: "#101922",
            card: "#1F2937",
            text: "#FFFFFF",
            muted: "#9CA3AF",
            border: "#374151",
            success: "#16A34A",
            danger: "#DC2626",
            info: "#3B82F6"
          },
          fontFamily: {
            sans: ["Inter", "sans-serif"],
          },
          borderRadius: { DEFAULT: "0.5rem" },
          boxShadow: { soft: "0 2px 4px rgba(0,0,0,0.2)" }
        },
      },
    };
  </script>
  <style>
    body { font-size: 0.9rem; }
  </style>
</head>
<body class="bg-background font-sans text-text">
<div class="flex h-screen">
  <!-- Sidebar (unchanged) -->
  <aside class="w-60 bg-card border-r border-border hidden lg:flex flex-col fixed h-full">
    <div class="flex items-center gap-2 px-5 h-16 border-b border-border">
      <span class="material-symbols-outlined text-primary">account_balance</span>
      <h1 class="text-base font-semibold">ExpenseApp</h1>
    </div>
    <!-- <nav class="flex-1 p-3 space-y-1 text-sm">
      <a class="flex items-center gap-2 rounded-md px-3 py-2 hover:bg-gray-800" href="{{ url_for('dashboard') }}">
        <span class="material-symbols-outlined">dashboard</span> Dashboard
      </a>
      <a class="flex items-center gap-2 rounded-md px-3 py-2 hover:bg-gray-800" href="{{ url_for('expense') }}">
        <span class="material-symbols-outlined">add_box</span> Add Expense
      </a>
      <a class="flex items-center gap-2 rounded-md bg-primary/20 text-primary px-3 py-2" href="{{ url_for('report') }}">
        <span class="material-symbols-outlined">analytics</span> Reports
      </a>
      <a class="flex items-center gap-2 rounded-md px-3 py-2 hover:bg-gray-800" href="{{ url_for('settings') }}">
        <span class="material-symbols-outlined">settings</span> Settings
      </a>
    </nav> -->
    <nav class="flex-1 p-3 space-y-1 text-sm">
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="{{ url_for('dashboard') }}">
          <span class="material-symbols-outlined">dashboard</span> Dashboard
        </a>
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="{{ url_for('expense') }}">
          <span class="material-symbols-outlined">add_box</span> Add Expense
        </a>
        <a class="flex items-center gap-2 rounded-md bg-primary/20 text-primary px-3 py-2" href="{{ url_for('report') }}">
          <span class="material-symbols-outlined">analytics</span> Reports
        </a>
        <a class="flex items-center gap-2 rounded-md px-3 py-2 text-muted hover:bg-gray-800" href="{{ url_for('settings') }}">
          <span class="material-symbols-outlined">settings</span> Settings
        </a>
      </nav>
    <div class="p-3">
      <a class="flex items-center gap-2 rounded-md px-3 py-2 hover:bg-gray-800" href="#">
        <span class="material-symbols-outlined">logout</span> Logout
      </a>
    </div>
  </aside>

  <!-- Main -->
  <div class="flex-1 flex flex-col overflow-y-auto lg:ml-60">
    <!-- Header -->
    <header class="sticky top-0 z-10 p-5 flex h-16 items-center justify-between border-b border-border bg-background/100 px-4 sm:px-6">
      <h2 class="text-lg font-semibold">Reports & Visualization</h2>
      <div class="flex items-center gap-3">
        <button class="p-2 rounded-full hover:bg-gray-800 text-muted">
          <span class="material-symbols-outlined">notifications</span>
        </button>
        <button class="flex items-center gap-1 bg-card text-sm px-3 py-1.5 rounded-md hover:bg-gray-700">
          <span class="material-symbols-outlined text-sm">download</span> CSV
        </button>
        <button class="flex items-center gap-1 bg-primary text-white text-sm px-3 py-1.5 rounded-md hover:bg-primary/90">
          <span class="material-symbols-outlined text-sm">picture_as_pdf</span> PDF
        </button>
      </div>
    </header>

    <!-- Content -->
<main class="flex-1 p-8 space-y-8 bg-[#0B1220]">

  <!-- Filters -->
  <div class="flex flex-wrap gap-4 items-end">
    <div>
      <label class="text-xs text-gray-400">Date Range</label>
      <select id="range" class="bg-[#111827] border border-gray-700 px-3 py-2 rounded-md text-sm">
        <option value="30">Last 30 days</option>
        <option value="90">Last 90 days</option>
        <option value="365" selected>This year</option>

      </select>
    </div>

    <div>
      <label class="text-xs text-gray-400">Category</label>
      <select id="category" class="bg-[#111827] border border-gray-700 px-3 py-2 rounded-md text-sm">
        <option value="All">All</option>
        <option value="Food">Food</option>
        <option value="Bills">Bills</option>
        <option value="Transport">Transport</option>
      </select>
    </div>

    <button
      onclick="loadReport()"
      class="px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-sm"
    >
      Apply Filters
    </button>
  </div>

  <!-- Charts -->
   
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-[#111827] p-5 rounded-xl">
      <h3 class="text-sm mb-2 text-gray-300">Expense Trend</h3>
      <!-- <canvas id="expenseChart"></canvas> -->
       <div class="h-64">
  <canvas id="expenseChart"></canvas>
</div>

    </div>

    <div class="bg-[#111827] p-5 rounded-xl">
      <h3 class="text-sm mb-2 text-gray-300">Category Breakdown</h3>
      <div class="h-64">
  <canvas id="categoryChart"></canvas>
</div>
    </div>
  </div>

  <!-- Income vs Expense -->
  <div class="bg-[#111827] p-5 rounded-xl">
    <h3 class="text-sm mb-2 text-gray-300">Income vs Expense</h3>
    <div class="h-72">
  <canvas id="incomeExpenseChart"></canvas>
</div>
  </div>

  <!-- Transactions -->
  <div>
    <h3 class="text-sm mb-3 text-gray-300">Transactions</h3>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="text-gray-400 border-b border-gray-700">
          <tr>
            <th class="py-2 text-left">Date</th>
            <th class="py-2 text-left">Description</th>
            <th class="py-2">Category</th>
            <th class="py-2 text-right">Amount</th>
          </tr>
        </thead>
        <tbody id="txnTable"></tbody>
      </table>
    </div>
  </div>

</main>

  </div>
</div>


<script>
let expenseChart, categoryChart, incomeExpenseChart;

function loadReport() {
  const range = document.getElementById("range").value;
  const category = document.getElementById("category").value;

  fetch(`/report_data?range=${range}&category=${category}`)
    .then(res => res.json())
    .then(data => {

  console.log("Report data:", data); // DEBUG (keep this)

  if (expenseChart) expenseChart.destroy();
  if (categoryChart) categoryChart.destroy();
  if (incomeExpenseChart) incomeExpenseChart.destroy();

  // Expense Trend
  expenseChart = new Chart(document.getElementById("expenseChart"), {
    type: "bar",
    data: {
      labels: data.months,
      datasets: [{
        label: "Expenses",
        data: data.expenses,
        backgroundColor: "#EF4444"
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });

  // Category Breakdown
  // const catLabels = Object.keys(data.category_expense || {});
  // const catValues = Object.values(data.category_expense || {});

  const catLabels = Object.keys(data.category_expense);
const catValues = Object.values(data.category_expense);

if (catLabels.length === 0) {
  catLabels.push("No data");
  catValues.push(1);
}


  categoryChart = new Chart(document.getElementById("categoryChart"), {
    type: "doughnut",
    data: {
      labels: catLabels.length ? catLabels : ["No data"],
      datasets: [{
        data: catValues.length ? catValues : [1],
        backgroundColor: [
          "#3B82F6", "#EF4444", "#22C55E", "#F59E0B", "#A855F7"
        ]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: "bottom" } }
    }
  });

  // Income vs Expense
  incomeExpenseChart = new Chart(document.getElementById("incomeExpenseChart"), {
    type: "line",
    data: {
      labels: data.months,
      datasets: [
        { label: "Income", data: data.income, borderColor: "#22C55E", tension: 0.3 },
        { label: "Expense", data: data.expenses, borderColor: "#EF4444", tension: 0.3 }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });


  const tbody = document.getElementById("txnTable");
tbody.innerHTML = "";

data.transactions.forEach(t => {
  tbody.innerHTML += `
    <tr class="border-b border-gray-700">
      <td class="py-2">${t.date}</td>
      <td class="py-2">${t.desc}</td>
      <td class="py-2 text-center">${t.category}</td>
      <td class="py-2 text-right ${t.type === "Expense" ? "text-red-400" : "text-green-400"}">
        ${t.amount}
      </td>
    </tr>
  `;
});

});

}

loadReport();

document.getElementById("range").addEventListener("change", loadReport);
document.getElementById("category").addEventListener("change", loadReport);

</script>



<style>
    body {
      font-size: 0.9rem; /* smaller base */
      background-color: #121212;
      color: #E5E7EB;
    }
    .chart-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 50%;
      width: 50%;
      color: #6B7280;
      font-size: 0.85rem;
    }
    .material-symbols-outlined {
      font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
    }
</style>


</body>
</html>
